<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MKRS â€“ Multimodal Knowledge Retrieval System</title>

    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 0 20px;
            background-color: #0f0f0f;
            color: #eaeaea;
        }

        h1 {
            margin-bottom: 10px;
            color: #ffffff;
        }

        .section {
            margin-bottom: 20px;
        }

        /* 1) Image preview box */
        #preview-box {
            width: 100%;
            height: 45vh;
            border: 2px dashed #444;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
            background: #161616;
        }

        #preview-box img {
            max-height: 100%;
            max-width: 100%;
            margin: 5px;
            border-radius: 6px;
            border: 1px solid #333;
        }

        /* Buttons */
        button {
            padding: 8px 14px;
            font-size: 14px;
            cursor: pointer;
            background-color: #2d7df6;
            color: #ffffff;
            border: none;
            border-radius: 6px;
        }

        button:hover {
            background-color: #1c64d8;
        }

        /* Reset button variant */
        button.reset {
            background-color: #444;
        }

        button.reset:hover {
            background-color: #666;
        }

        /* Status text */
        .status {
            margin-left: 10px;
            font-size: 13px;
            color: #7dd3fc;
        }

        /* Prompt + submit row */
        .prompt-row {
            display: flex;
            gap: 10px;
        }

        textarea {
            flex: 1;
            height: 70px;
            resize: vertical;
            font-size: 14px;
            padding: 8px;
            background-color: #121212;
            color: #eaeaea;
            border: 1px solid #444;
            border-radius: 6px;
        }

        textarea::placeholder {
            color: #888;
        }

        /* Output box */
        #output-box {
            min-height: 120px;
            padding: 10px;
            border-radius: 6px;
            background: #121212;
            border: 1px solid #444;
            white-space: pre-wrap;
            font-family: monospace;
            color: #eaeaea;
        }
    </style>
</head>

<body>

    <h1>MKRS</h1>
    <p>Multimodal Knowledge Retrieval System</p>

    <!-- 1) Image preview -->
    <div class="section">
        <div id="preview-box">
            <span id="preview-placeholder">Image preview</span>
        </div>
    </div>

    <!-- 2) Upload button -->
    <div class="section">
        <label for="imageInput"><strong>Upload Image(s):</strong></label><br />
        <input
        type="file"
        id="imageInput"
        accept="image/*"
        multiple
        onchange="handleImageUpload()"
        />
        <span class="status" id="imageStatus"></span>
    </div>

    <!-- 3) Prompt input -->
    <div class="section prompt-row">
        <textarea
        id="promptInput"
        placeholder="Ask a question about the image(s)"
        ></textarea>
        <button onclick="submitPrompt()">Submit Prompt</button>
        <span class="status" id="promptStatus"></span>
    </div>

    <!-- 4) Output -->
    <div class="section">
        <div id="output-box">VLM Output</div>
    </div>

    <!-- 5) Reset -->
    <div class="section">
        <button onclick="resetAll()">Reset</button>
    </div>

    <script>
        let uploadedImages = [];

        function handleImageUpload() {
            const input = document.getElementById("imageInput");
            const previewBox = document.getElementById("preview-box");
            const placeholder = document.getElementById("preview-placeholder");
            const status = document.getElementById("imageStatus");

            uploadedImages = Array.from(input.files);

            previewBox.innerHTML = "";
            uploadedImages.forEach(file => {
                const img = document.createElement("img");
                img.src = URL.createObjectURL(file);
                previewBox.appendChild(img);
            });

            if (uploadedImages.length > 0) {
                status.textContent = "Image(s) uploaded successfully.";
            }
        }

        async function submitPrompt() {
            const prompt = document.getElementById("promptInput").value;
            const outputBox = document.getElementById("output-box");
            const status = document.getElementById("promptStatus");

            if (!prompt || uploadedImages.length === 0) {
                alert("Please upload image(s) and enter a prompt.");
                return;
            }

            status.textContent = "Prompt submitted successfully.";
            outputBox.textContent = "Running inference...";

            const formData = new FormData();

            // Mode 1: backend will use first image
            uploadedImages.forEach(img => {
                formData.append("images", img);
            });

            formData.append("question", prompt);

            try {
                    const res = await fetch("/qa/single", {
                    method: "POST",
                    body: formData
                    });

                    const data = await res.json();
                    outputBox.textContent = data.answer || JSON.stringify(data, null, 2);
                } catch (err) {
                    outputBox.textContent = "Error: " + err;
                }
        }

        function resetAll() {
            document.getElementById("imageInput").value = "";
            document.getElementById("promptInput").value = "";
            document.getElementById("output-box").textContent = "VLM Output";
            document.getElementById("imageStatus").textContent = "";
            document.getElementById("promptStatus").textContent = "";
            uploadedImages = [];

            const previewBox = document.getElementById("preview-box");
            previewBox.innerHTML = '<span id="preview-placeholder">Image preview</span>';
        }
    </script>

</body>
</html>